{"version":3,"file":"ButtonBase.js","sourceRoot":"","sources":["../../../../../src/packages/button/src/ButtonBase.ts"],"names":[],"mappings":"AAAA,kDAAkD;;AAElD,OAAO,EACH,QAAQ,EACR,IAAI,EAEJ,KAAK,GAER,MAAM,sBAAsB,CAAC;AAC9B,OAAO,EAAE,UAAU,EAAE,MAAM,iCAAiC,CAAC;AAC7D,OAAO,EAAE,SAAS,EAAE,MAAM,+BAA+B,CAAC;AAC1D,OAAO,EAAE,eAAe,EAAE,mBAAmB,EAAE,MAAM,wBAAwB,CAAC;AAE9E,MAAM,OAAO,UAAW,SAAQ,UAAU,CACtC,eAAe,CAAC,mBAAmB,CAAC,SAAS,EAAE,eAAe,CAAC,CAAC,CACnE;IA6CG;QACI,KAAK,EAAE,CAAC;QAxCL,WAAM,GAAG,KAAK,CAAC;QAGf,SAAI,GAAkC,QAAQ,CAAC;QAsClD,IAAI,CAAC,UAAU,GAAG,IAAI,CAAC,UAAU,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;QAE7C,IAAI,CAAC,gBAAgB,CAAC,OAAO,EAAE,IAAI,CAAC,kBAAkB,EAAE;YACpD,OAAO,EAAE,IAAI;SAChB,CAAC,CAAC;IACP,CAAC;IAnDD,IAAc,OAAO;QACjB,OAAO,IAAI,CAAC,oBAAoB,CAAC;IACrC,CAAC;IAQD,IAAc,QAAQ;QAClB,OAAO,IAAI,CAAC,cAAc,CAAC;IAC/B,CAAC;IAKD,IAAW,YAAY;QACnB,OAAO,IAAI,CAAC;IAChB,CAAC;IAED,IAAc,aAAa;QACvB,MAAM,OAAO,GAAG;YACZ,IAAI,CAAA;2CAC2B,CAAC,IAAI,CAAC,QAAQ;;;uCAGlB,IAAI,CAAC,sBAAsB;;;aAGrD;SACJ,CAAC;QACF,IAAI,IAAI,CAAC,OAAO,EAAE;YACd,OAAO,CAAC,OAAO,CAAC,IAAI,CAAA;;;;kCAIE,CAAC,IAAI,CAAC,QAAQ;;aAEnC,CAAC,CAAC;SACN;QACD,OAAO,OAAO,CAAC;IACnB,CAAC;IAWM,KAAK;QACR,IAAI,IAAI,CAAC,QAAQ,EAAE;YACf,OAAO;SACV;QAED,IAAI,IAAI,CAAC,gBAAgB,EAAE,EAAE;YACzB,OAAO;SACV;QAED,KAAK,CAAC,KAAK,EAAE,CAAC;IAClB,CAAC;IAEO,kBAAkB,CAAC,KAAY;QACnC,IAAI,IAAI,CAAC,QAAQ,EAAE;YACf,KAAK,CAAC,cAAc,EAAE,CAAC;YACvB,KAAK,CAAC,wBAAwB,EAAE,CAAC;YACjC,KAAK,CAAC,eAAe,EAAE,CAAC;YACxB,OAAO,KAAK,CAAC;SAChB;IACL,CAAC;IAEO,UAAU;QACd,IAAI,CAAC,KAAK,EAAE,CAAC;IACjB,CAAC;IAEO,gBAAgB;QACpB,IAAI,OAAO,GAAG,KAAK,CAAC;QACpB,IAAI,IAAI,CAAC,aAAa,EAAE;YACpB,IAAI,CAAC,aAAa,CAAC,KAAK,EAAE,CAAC;YAC3B,OAAO,GAAG,IAAI,CAAC;SAClB;aAAM,IAAI,IAAI,CAAC,IAAI,KAAK,QAAQ,EAAE;YAC/B,MAAM,KAAK,GAAG,QAAQ,CAAC,aAAa,CAAC,QAAQ,CAAC,CAAC;YAC/C,KAAK,CAAC,IAAI,GAAG,IAAI,CAAC,IAAI,CAAC;YACvB,IAAI,CAAC,qBAAqB,CAAC,UAAU,EAAE,KAAK,CAAC,CAAC;YAC9C,KAAK,CAAC,KAAK,EAAE,CAAC;YACd,KAAK,CAAC,MAAM,EAAE,CAAC;YACf,OAAO,GAAG,IAAI,CAAC;SAClB;QACD,OAAO,OAAO,CAAC;IACnB,CAAC;IAEM,YAAY;QACf,OAAO,IAAI,CAAA;cACL,IAAI,CAAC,aAAa;cAClB,KAAK,CAAC,YAAY,CAAC;YACjB,EAAE,EAAE,QAAQ;YACZ,UAAU,EAAE,IAAI;YAChB,SAAS,EAAE,sBAAsB;SACpC,CAAC;SACL,CAAC;IACN,CAAC;IAES,YAAY;QAClB,OAAO,IAAI,CAAA,IAAI,IAAI,CAAC,aAAa,GAAG,CAAC;IACzC,CAAC;IAES,MAAM;QACZ,OAAO,IAAI,CAAC,IAAI,IAAI,IAAI,CAAC,IAAI,CAAC,MAAM,GAAG,CAAC;YACpC,CAAC,CAAC,IAAI,CAAC,YAAY,EAAE;YACrB,CAAC,CAAC,IAAI,CAAC,YAAY,EAAE,CAAC;IAC9B,CAAC;IAES,aAAa,CAAC,KAAoB;QACxC,MAAM,EAAE,IAAI,EAAE,GAAG,KAAK,CAAC;QACvB,QAAQ,IAAI,EAAE;YACV,KAAK,OAAO;gBACR,KAAK,CAAC,cAAc,EAAE,CAAC;gBACvB,IAAI,OAAO,IAAI,CAAC,IAAI,KAAK,WAAW,EAAE;oBAClC,IAAI,CAAC,gBAAgB,CAAC,OAAO,EAAE,IAAI,CAAC,WAAW,CAAC,CAAC;oBACjD,IAAI,CAAC,MAAM,GAAG,IAAI,CAAC;iBACtB;gBACD,MAAM;YACV;gBACI,MAAM;SACb;IACL,CAAC;IAEO,cAAc,CAAC,KAAoB;QACvC,MAAM,EAAE,IAAI,EAAE,GAAG,KAAK,CAAC;QACvB,QAAQ,IAAI,EAAE;YACV,KAAK,OAAO;gBACR,IAAI,CAAC,KAAK,EAAE,CAAC;gBACb,MAAM;YACV;gBACI,MAAM;SACb;IACL,CAAC;IAES,WAAW,CAAC,KAAoB;QACtC,MAAM,EAAE,IAAI,EAAE,GAAG,KAAK,CAAC;QACvB,QAAQ,IAAI,EAAE;YACV,KAAK,OAAO;gBACR,IAAI,CAAC,mBAAmB,CAAC,OAAO,EAAE,IAAI,CAAC,WAAW,CAAC,CAAC;gBACpD,IAAI,CAAC,MAAM,GAAG,KAAK,CAAC;gBACpB,IAAI,CAAC,KAAK,EAAE,CAAC;gBACb,MAAM;YACV;gBACI,MAAM;SACb;IACL,CAAC;IAEO,kBAAkB;QACtB,IAAI,CAAC,MAAM,GAAG,KAAK,CAAC;IACxB,CAAC;IAEO,iBAAiB;QACrB,IAAI,CAAC,MAAM,GAAG,IAAI,CAAC;IACvB,CAAC;IAEO,YAAY;QAChB,IAAI,IAAI,CAAC,IAAI,IAAI,IAAI,CAAC,IAAI,CAAC,MAAM,GAAG,CAAC,EAAE;YACnC,IAAI,CAAC,eAAe,CAAC,MAAM,CAAC,CAAC;YAC7B,IAAI,CAAC,mBAAmB,CAAC,OAAO,EAAE,IAAI,CAAC,gBAAgB,CAAC,CAAC;SAC5D;aAAM,IAAI,CAAC,IAAI,CAAC,YAAY,CAAC,MAAM,CAAC,EAAE;YACnC,IAAI,CAAC,YAAY,CAAC,MAAM,EAAE,QAAQ,CAAC,CAAC;YACpC,IAAI,CAAC,gBAAgB,CAAC,OAAO,EAAE,IAAI,CAAC,gBAAgB,CAAC,CAAC;SACzD;IACL,CAAC;IAES,YAAY,CAAC,OAAuB;QAC1C,KAAK,CAAC,YAAY,CAAC,OAAO,CAAC,CAAC;QAC5B,IAAI,CAAC,IAAI,CAAC,YAAY,CAAC,UAAU,CAAC,EAAE;YAChC,IAAI,CAAC,QAAQ,GAAG,CAAC,CAAC;SACrB;QACD,IAAI,CAAC,YAAY,EAAE,CAAC;QACpB,IAAI,CAAC,gBAAgB,CAAC,SAAS,EAAE,IAAI,CAAC,aAAa,CAAC,CAAC;QACrD,IAAI,CAAC,gBAAgB,CAAC,UAAU,EAAE,IAAI,CAAC,cAAc,CAAC,CAAC;QACvD,IAAI,CAAC,gBAAgB,CAAC,aAAa,EAAE,IAAI,CAAC,iBAAiB,CAAC,CAAC;IACjE,CAAC;IAES,OAAO,CAAC,OAAuB;QACrC,KAAK,CAAC,OAAO,CAAC,OAAO,CAAC,CAAC;QACvB,IAAI,OAAO,CAAC,GAAG,CAAC,MAAM,CAAC,EAAE;YACrB,IAAI,CAAC,YAAY,EAAE,CAAC;SACvB;QACD,IAAI,OAAO,CAAC,GAAG,CAAC,OAAO,CAAC,EAAE;YACtB,IAAI,CAAC,YAAY,CAAC,YAAY,EAAE,IAAI,CAAC,KAAK,IAAI,EAAE,CAAC,CAAC;SACrD;QACD,IAAI,OAAO,CAAC,GAAG,CAAC,QAAQ,CAAC,EAAE;YACvB,IAAI,IAAI,CAAC,MAAM,EAAE;gBACb,IAAI,CAAC,gBAAgB,CAAC,UAAU,EAAE,IAAI,CAAC,kBAAkB,CAAC,CAAC;gBAC3D,IAAI,CAAC,gBAAgB,CAAC,WAAW,EAAE,IAAI,CAAC,kBAAkB,CAAC,CAAC;gBAC5D,IAAI,CAAC,gBAAgB,CAAC,cAAc,EAAE,IAAI,CAAC,kBAAkB,CAAC,CAAC;aAClE;iBAAM;gBACH,IAAI,CAAC,mBAAmB,CAAC,UAAU,EAAE,IAAI,CAAC,kBAAkB,CAAC,CAAC;gBAC9D,IAAI,CAAC,mBAAmB,CAAC,WAAW,EAAE,IAAI,CAAC,kBAAkB,CAAC,CAAC;gBAC/D,IAAI,CAAC,mBAAmB,CACpB,cAAc,EACd,IAAI,CAAC,kBAAkB,CAC1B,CAAC;aACL;SACJ;QACD,IAAI,IAAI,CAAC,aAAa,EAAE;YACpB,IAAI,CAAC,aAAa,CAAC,gBAAgB,CAAC,OAAO,EAAE,IAAI,CAAC,UAAU,CAAC,CAAC;YAC9D,IAAI,CAAC,aAAa,CAAC,QAAQ,GAAG,CAAC,CAAC,CAAC;SACpC;IACL,CAAC;CACJ;AA7MG;IADC,QAAQ,CAAC,EAAE,IAAI,EAAE,OAAO,EAAE,OAAO,EAAE,IAAI,EAAE,CAAC;0CACrB;AAGtB;IADC,QAAQ,CAAC,EAAE,IAAI,EAAE,MAAM,EAAE,CAAC;wCAC2B;AAOtD;IADC,KAAK,CAAC,SAAS,CAAC;iDACyB","sourcesContent":["/* Copyright 2021 i2c Inc. All rights reserved. */\r\n\r\nimport {\r\n    property,\r\n    html,\r\n    TemplateResult,\r\n    query,\r\n    PropertyValues,\r\n} from '../../base/src/index';\r\nimport { LikeAnchor } from '../../shared/src/like-anchor.js';\r\nimport { Focusable } from '../../shared/src/focusable.js';\r\nimport { ObserveSlotText, ObserveSlotPresence } from '../../shared/src/index';\r\n\r\nexport class ButtonBase extends LikeAnchor(\r\n    ObserveSlotText(ObserveSlotPresence(Focusable, '[slot=\"icon\"]'))\r\n) {\r\n    protected get hasIcon(): boolean {\r\n        return this.slotContentIsPresent;\r\n    }\r\n\r\n    @property({ type: Boolean, reflect: true })\r\n    public active = false;\r\n\r\n    @property({ type: String })\r\n    public type: 'button' | 'submit' | 'reset' = 'button';\r\n\r\n    protected get hasLabel(): boolean {\r\n        return this.slotHasContent;\r\n    }\r\n\r\n    @query('.anchor')\r\n    private anchorElement!: HTMLButtonElement;\r\n\r\n    public get focusElement(): HTMLElement {\r\n        return this;\r\n    }\r\n\r\n    protected get buttonContent(): TemplateResult[] {\r\n        const content = [\r\n            html`\r\n                <div id=\"label\" ?hidden=\"${!this.hasLabel}\">\r\n                    <slot\r\n                        id=\"slot\"\r\n                        @slotchange=\"${this.manageTextObservedSlot}\"\r\n                    ></slot>\r\n                </div>\r\n            `,\r\n        ];\r\n        if (this.hasIcon) {\r\n            content.unshift(html`\r\n                <slot\r\n                    class=\"icon\"\r\n                    name=\"icon\"\r\n                    ?icon-only=\"${!this.hasLabel}\"\r\n                ></slot>\r\n            `);\r\n        }\r\n        return content;\r\n    }\r\n\r\n    constructor() {\r\n        super();\r\n        this.proxyFocus = this.proxyFocus.bind(this);\r\n\r\n        this.addEventListener('click', this.handleClickCapture, {\r\n            capture: true,\r\n        });\r\n    }\r\n\r\n    public click(): void {\r\n        if (this.disabled) {\r\n            return;\r\n        }\r\n\r\n        if (this.shouldProxyClick()) {\r\n            return;\r\n        }\r\n\r\n        super.click();\r\n    }\r\n\r\n    private handleClickCapture(event: Event): void | boolean {\r\n        if (this.disabled) {\r\n            event.preventDefault();\r\n            event.stopImmediatePropagation();\r\n            event.stopPropagation();\r\n            return false;\r\n        }\r\n    }\r\n\r\n    private proxyFocus(): void {\r\n        this.focus();\r\n    }\r\n\r\n    private shouldProxyClick(): boolean {\r\n        let handled = false;\r\n        if (this.anchorElement) {\r\n            this.anchorElement.click();\r\n            handled = true;\r\n        } else if (this.type !== 'button') {\r\n            const proxy = document.createElement('button');\r\n            proxy.type = this.type;\r\n            this.insertAdjacentElement('afterend', proxy);\r\n            proxy.click();\r\n            proxy.remove();\r\n            handled = true;\r\n        }\r\n        return handled;\r\n    }\r\n\r\n    public renderAnchor(): TemplateResult {\r\n        return html`\r\n            ${this.buttonContent}\r\n            ${super.renderAnchor({\r\n                id: 'button',\r\n                ariaHidden: true,\r\n                className: 'button anchor hidden',\r\n            })}\r\n        `;\r\n    }\r\n\r\n    protected renderButton(): TemplateResult {\r\n        return html` ${this.buttonContent} `;\r\n    }\r\n\r\n    protected render(): TemplateResult {\r\n        return this.href && this.href.length > 0\r\n            ? this.renderAnchor()\r\n            : this.renderButton();\r\n    }\r\n\r\n    protected handleKeydown(event: KeyboardEvent): void {\r\n        const { code } = event;\r\n        switch (code) {\r\n            case 'Space':\r\n                event.preventDefault();\r\n                if (typeof this.href === 'undefined') {\r\n                    this.addEventListener('keyup', this.handleKeyup);\r\n                    this.active = true;\r\n                }\r\n                break;\r\n            default:\r\n                break;\r\n        }\r\n    }\r\n\r\n    private handleKeypress(event: KeyboardEvent): void {\r\n        const { code } = event;\r\n        switch (code) {\r\n            case 'Enter':\r\n                this.click();\r\n                break;\r\n            default:\r\n                break;\r\n        }\r\n    }\r\n\r\n    protected handleKeyup(event: KeyboardEvent): void {\r\n        const { code } = event;\r\n        switch (code) {\r\n            case 'Space':\r\n                this.removeEventListener('keyup', this.handleKeyup);\r\n                this.active = false;\r\n                this.click();\r\n                break;\r\n            default:\r\n                break;\r\n        }\r\n    }\r\n\r\n    private handleRemoveActive(): void {\r\n        this.active = false;\r\n    }\r\n\r\n    private handlePointerdown(): void {\r\n        this.active = true;\r\n    }\r\n\r\n    private manageAnchor(): void {\r\n        if (this.href && this.href.length > 0) {\r\n            this.removeAttribute('role');\r\n            this.removeEventListener('click', this.shouldProxyClick);\r\n        } else if (!this.hasAttribute('role')) {\r\n            this.setAttribute('role', 'button');\r\n            this.addEventListener('click', this.shouldProxyClick);\r\n        }\r\n    }\r\n\r\n    protected firstUpdated(changed: PropertyValues): void {\r\n        super.firstUpdated(changed);\r\n        if (!this.hasAttribute('tabindex')) {\r\n            this.tabIndex = 0;\r\n        }\r\n        this.manageAnchor();\r\n        this.addEventListener('keydown', this.handleKeydown);\r\n        this.addEventListener('keypress', this.handleKeypress);\r\n        this.addEventListener('pointerdown', this.handlePointerdown);\r\n    }\r\n\r\n    protected updated(changed: PropertyValues): void {\r\n        super.updated(changed);\r\n        if (changed.has('href')) {\r\n            this.manageAnchor();\r\n        }\r\n        if (changed.has('label')) {\r\n            this.setAttribute('aria-label', this.label || '');\r\n        }\r\n        if (changed.has('active')) {\r\n            if (this.active) {\r\n                this.addEventListener('focusout', this.handleRemoveActive);\r\n                this.addEventListener('pointerup', this.handleRemoveActive);\r\n                this.addEventListener('pointerleave', this.handleRemoveActive);\r\n            } else {\r\n                this.removeEventListener('focusout', this.handleRemoveActive);\r\n                this.removeEventListener('pointerup', this.handleRemoveActive);\r\n                this.removeEventListener(\r\n                    'pointerleave',\r\n                    this.handleRemoveActive\r\n                );\r\n            }\r\n        }\r\n        if (this.anchorElement) {\r\n            this.anchorElement.addEventListener('focus', this.proxyFocus);\r\n            this.anchorElement.tabIndex = -1;\r\n        }\r\n    }\r\n}\r\n"]}